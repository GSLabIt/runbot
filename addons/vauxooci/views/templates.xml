<openerp>
    <data>
        <template id="runbot.build_name">
            <t t-set="klass_column" t-value="'build-title text-right'"/>
            <div t-attf-class="{{klass_column}}" t-if="bu['state']=='pending'">
                <h5><i class="material-icons">pause</i> <t t-esc="bu['dest']"/></h5>
            </div>
            <div t-attf-class="{{klass_column}}" t-if="bu['state']=='testing'">
                <h5><i class="material-icons">cached</i> <t t-esc="bu['dest']"/></h5>
            </div>
            <div t-attf-class="{{klass_column}}" t-if="bu['result']=='ok'">
                <h5><i class="material-icons">thumb_up</i> <t t-esc="bu['dest']"/></h5>
            </div>
            <div t-attf-class="{{klass_column}}" t-if="bu['result']=='ko'">
                <h5><i class="material-icons">bug_report</i> <t t-esc="bu['dest']"/></h5>
            </div>
            <div t-attf-class="{{klass_column}}" t-if="bu['result']=='warn'">
                <h5><i class="material-icons">warning</i> <t t-esc="bu['dest']"/></h5>
            </div>
            <div t-attf-class="{{klass_column}}" t-if="bu['result']=='skipped'">
                <h5><i class="material-icons">block</i> <t t-esc="bu['dest']"/></h5>
            </div>
            <div t-attf-class="{{klass_column}}" t-if="bu['result']=='killed'">
                <h5><i class="material-icons">sync_problem</i> <t t-esc="bu['dest']"/></h5>
            </div>
            <div t-attf-class="{{klass_column}}" t-if="not bu['result'] and not bu['state']=='testing'">
                <h5><i class="material-icons">error</i> <t t-esc="bu['dest']"/></h5>
            </div>
        </template>
        <!-- TODO: Button to set the kill this and force rebuild with proper management.
             -->

        <template id="runbot.build_button">
            <div class="btn-group-vertical">
            <div class="btn-group">
                <button t-attf-class="btn btn-raised dropdown-toggle btn-{{ klass }}" data-toggle="dropdown">
                    <t t-if="bu['committer'] and bu['author'] == bu['committer']">
                        <i class="material-icons">person</i>
                    </t>
                    <t t-if="bu['committer'] and bu['author'] != bu['committer']">
                        <i class="material-icons">people</i>
                    </t>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                    <li class="dropdown-header">Authors</li>
                    <li class="disabled">
                        <a href="#" t-id="bu['author']"><small>Author:</small><t t-esc="bu['author']"/></a>
                    </li>
                    <li class="disabled" t-if="bu['committer'] and bu['author'] != bu['committer']">
                        <a href="#" t-id="bu['committer']"><small>Committed by:</small> <t t-esc="bu['committer']"/></a>
                    </li>
                    <li t-if="bu['state']!='testing' and bu['state']!='pending'" class="divider"></li>
                    <li class="dropdown-header">Information</li>
                    <li class="disabled"><a href="#">Runtime: <t t-esc="bu['job_time']"/>s</a></li>
                    <li class="disabled"><a href="#">Port: <t t-esc="bu['port']"/></a></li>
                    <li class="disabled"><a href="#">Age: <t t-esc="bu['job_age']"/></a></li>
                </ul>
            </div>
            <div class="btn-group">
                <button t-attf-class="btn btn-raised dropdown-toggle btn-{{klass}}" data-toggle="dropdown">
                    <t t-if="bu['state']=='running'"><i class="material-icons">ondemand_video</i> </t> <t t-if="bu['state']!='running'"><i class="material-icons">settings</i></t> <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                    <t t-if="bu['state']=='running'">
                        <li class="dropdown-header"><i class="fa fa-sign-in"></i> Connect</li>
                        <li><a t-attf-href="http://{{bu['domain']}}/">Home</a></li>
                        <li><a t-attf-href="http://{{bu['domain']}}/?db={{bu['real_dest']}}-all">All</a></li>
                        <li><a t-attf-href="http://{{bu['domain']}}/?db={{bu['real_dest']}}-base">Base</a></li>
                    </t>
                    <li class="dropdown-header"><i class="fa fa-hand-o-right"></i> Actions</li>
                    <li t-if="bu['result']=='skipped'">
                        <a href="#" class="runbot-rebuild" t-att-data-runbot-build="bu['id']">Force Build <i class="fa fa-level-up"></i></a>
                    </li>
                    <li t-if="bu['result']!='skipped' and bu['state']!='done'">
                        <a href="#" class="runbot-force-kill" title="TODO: backend">Kill</a>
                    </li>
                    <li t-if="bu['state'] in ['done','running'] and bu_index==0">
                        <a href="#" class="runbot-rebuild" t-att-data-runbot-build="bu['id']">Rebuild <i class="fa fa-refresh"/></a>
                    </li>
                    <li class="dropdown-header"><i class="fa fa-github"/> Links</li>
                    <li><a t-attf-href="/runbot/build/{{bu['id']}}"> Go to build</a></li>
                    <li><a t-attf-href="{{br['branch'].branch_url}}" target="_new" title="Branch or Pull">Code Review</a></li>
                    <li><a t-attf-href="https://{{repo.base}}/commit/{{bu['name']}}">Commit</a></li>
                    <li><a t-attf-href="https://{{repo.base}}/compare/{{br['branch'].branch_name}}">Compare</a></li>
                    <li class="dropdown-header"><i class="fa fa-file-text-o"/> Logs</li>
                    <li t-if="bu['host']"><a t-attf-href="http://{{bu['host']}}/runbot/static/build/#{bu['real_dest']}/logs/job_10_test_base.txt">Image Build</a></li>
                    <li t-if="bu['host']"><a t-attf-href="http://{{bu['host']}}/runbot/static/build/#{bu['real_dest']}/logs/job_20_test_all.txt">Run Logs</a></li>
                    <li><a t-attf-href="/runbot/build/{{bu['id']}}">Resumed</a></li>
                </ul>
            </div>
            </div>
        </template>

        <!-- TODO: Position properly it brakes navbar layout.
             as it was.
             -->
        <template id="vauxooci.filters" name="Search template">
            <form class="navbar-form form-inline">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                  Filter <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                  <li t-if="filters['pending']=='0'"><a t-att-href="qu(pending=1)">Pending</a></li>
                  <li t-if="filters['pending']=='1'"><a t-att-href="qu(pending='0')"><i class="fa fa-check"/> Pending</a></li>
                  <li t-if="filters['testing']=='0'"><a t-att-href="qu(testing=1)">Testing</a></li>
                  <li t-if="filters['testing']=='1'"><a t-att-href="qu(testing='0')"><i class="fa fa-check"/> Testing</a></li>
                  <li t-if="filters['running']=='0'"><a t-att-href="qu(running=1)">Running</a></li>
                  <li t-if="filters['running']=='1'"><a t-att-href="qu(running='0')"><i class="fa fa-check"/> Running</a></li>
                  <li t-if="filters['done']=='0'"><a t-att-href="qu(done=1)">Done</a></li>
                  <li t-if="filters['done']=='1'"><a t-att-href="qu(done='0')"><i class="fa fa-check"/> Done</a></li>
                  <li class="divider"></li>
                  <li t-att-class="'active' if limit=='100' else ''"><a t-att-href="qu(limit=100)">Show last 100</a></li>
                  <li t-att-class="'active' if limit=='1000' else ''"><a t-att-href="qu(limit=1000)">Show last 1000</a></li>
                  <li t-att-class="'active' if limit=='10000' else ''"><a t-att-href="qu(limit=10000)">Show last 10000</a></li>
                </ul>
            </form>
        </template>
        <template id="vauxooci.input_search" name="Search template">
          <t t-if="repo">
            <form role="search" t-att-action="qu(search='')" method="get">
                <div class="form-group label-floating is-empty">
                    <div class="input-group">
                        <span class="input-group-btn">
                            <button type="button" class="btn hidden-xs btn-fab btn-fab-mini btn-default">
                                <i class="material-icons">search</i>
                            </button>
                        </span>
                        <label for="search0" class="control-label hidden-xs">Search criteria, id, branch or PR allowed.</label>
                        <label for="search0" class="control-label hidden-md hidden-lg">Criteria: id, branch or PR allowed.</label>
                        <input type="text" name="search" id="search0" t-att-value="search" class="input-group form-control"/>
                    </div>
                </div>
            </form>
          </t>
        </template>
        <template id="vauxooci.search" name="Search template">
          <t t-if="repo">
            <form class="navbar-form navbar-left" role="search" t-att-action="qu(search='')" method="get">
                <div class="form-group label-floating input-group">
                    <span class="input-group-btn"><i class="material-icons">search</i></span>
                    <input type="search" name="search" id="search0"
                           t-att-value="search" class="form-control col-sm-8"/>
                    <span class="help-block">criteria id, branch or pull requests</span>
                </div>
            </form>
          </t>
        </template>
        <template id="vauxooci.login_menu" name="Dropdown for repositories">
            <div class="btn-group login">
                <a href="#" class="btn btn-fab btn-info dropdown-toggle" data-toggle="dropdown">
                    <!-- TODO: unwire this url to the user one.
                         -->
                    <img src="http://www.androidslots.co.uk/images/Example-of-an-avatar-illustration-297x300.png"
                        class="circle"/>
                </a>
                <ul class="dropdown-menu">
                    <li class="dropdown" t-ignore="true" t-if="website.user_id != user_id">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <b>
                                <span t-esc="(len(user_id.name)&gt;25) and (user_id.name[:23]+'...') or user_id.name"/>
                                <span class="caret"></span>
                            </b>
                        </a>
                        <ul class="dropdown-menu js_usermenu" role="menu">
                            <li id="o_logout"><a t-attf-href="/web/session/logout?redirect=/" role="menuitem">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </template>
        <template id="vauxooci.dropdown_repositories" name="Dropdown for repositories">
            <div class="btn-group">
                <a href="#" class="btn btn-fab btn-info dropdown-toggle" data-toggle="dropdown">
                    <i class="material-icons">more_vert</i>
                </a>
                <ul class="dropdown-menu">
                    <t t-foreach='repos' t-as='re'>
                        <li><a t-attf-href="/runbot/repo/{{slug(re)}}"><t t-esc="re.base"/></a></li>
                    </t>
                </ul>
            </div>
        </template>
        <template id="vauxooci.info_modal" name="Info">
            <div class="modal fade" id="info_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
                            <h4 class="modal-title" id="myModalLabel">General Status</h4>
                        </div>
                        <div class="modal-body">
                            <t  t-foreach="host_stats" t-as="hs">
                            <p class="lead text-center">
                                <span class="label label-default">
                                    <t t-esc="hs['host']"/>: <t t-esc="hs['testing']"/> testing, <t t-esc="hs['running']"/> running
                                </span>&amp;nbsp;
                            </p>
                            </t>
                        </div>
                        <div class="modal-footer">
                            <span class="label label-info">Pending: <t t-esc="pending_total"/></span>
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        <template id="vauxooci.build_body" name="Row on Buld table">
                <div class="row">
                    <div class="col-xs-1">
                        <t t-call="runbot.build_button"/>
                    </div>
                    <div class="col-xs-10">
                        <t t-call="runbot.build_name"/>
                    </div>
                </div>
                <p>
                    <b><i t-if="not br['branch'].sticky" class="material-icons">call_merge</i>
                    <i t-if="br['branch'].sticky" class="material-icons" style="color: #f0ad4e">star</i>
                    <t t-esc="br['branch'].branch_name"/> <t t-if="bu['state']=='running'">is</t><t t-if="bu['state']!='running'">was</t> <t t-esc="bu['state']"/></b>,  and It was authored by: <b><t t-esc="bu['author']"/></b>
                    <t t-if="bu['committer'] and bu['author'] != bu['committer']">
                    and committed by: <b><t t-esc="bu['committer']"/></b>
                    <label class="label label-success">
                        <i class="material-icons">sentiment_very_satisfied</i>
                    </label>
                    </t>
                </p>
                <p class="lead">
                    <t t-if="br['builds'][0]['committer'] and br['branch'].sticky and br['builds'][0]['author'] == br['builds'][0]['committer']">
                        <span class="label label-warning" title="Not good, author and commiter is the same, this should be reiviewed by somebody else.">
                            <i class="material-icons">sentiment_very_dissatisfied</i>
                        </span>
                    </t><br/>
                    <t class="lead" t-esc="bu['subject']"/>
                </p>
                <div class="text-right">
                    <small t-if="not hide_time">Built <t t-esc="bu['job_age']"/> ago and took <t t-esc="bu['job_time']"/></small>
                    <small><b> on </b><t t-esc="bu['host']"/></small>
                </div>
        </template>
        <template id="vauxooci.build_row_xs" name="Row Header">
            <div t-attf-class="row row-full hidden-md hidden-lg hidden-sm" style="border-bottom: 1px solid #ccc; padding-bottom: 0px">
                <div t-attf-class="col-xs-1 btn text-center btn-{{klass_p}} btn-raised">
                    <div t-if="br['branch'].sticky">
                        <i class="material-icons" style="color: #f0ad4e">star</i>
                    </div>
                    <div  t-if="not br['branch'].sticky">
                        <i class="material-icons">call_merge</i>
                    </div>
                    <div class="btn-checked">
                        <i class="material-icons">check_box_outline_blank</i>
                        <i class="material-icons hidden">check_box</i>
                    </div>
                    <div t-if="br['builds'][0]['committer'] and br['branch'].sticky and br['builds'][0]['author'] != br['builds'][0]['committer']">
                        <i class="material-icons">tag_faces</i>
                    </div>
                    <div t-if="br['builds'][0]['committer'] and br['branch'].sticky and br['builds'][0]['author'] == br['builds'][0]['committer']">
                        <i class="material-icons">sentiment_very_dissatisfied</i>
                    </div>
                </div>
                <div class="col-xs-11">
                    <div class="row">
                        <label class="label label-title-left">
                            <t t-if="br['builds'][0]['committer'] and br['builds'][0]['author'] != br['builds'][0]['committer']">
                                <t t-esc="br['builds'][0]['author']"/>, <b>with</b> <t t-esc="br['builds'][0]['committer']"/>
                            </t>
                            <t t-if="br['builds'][0]['committer'] and br['builds'][0]['author'] == br['builds'][0]['committer']">
                                <t t-esc="br['builds'][0]['author']"/>
                            </t>
                        </label>
                        <label class="label label-title-right">
                            <t t-esc="br['branch'].branch_name"/> <t t-esc="br['builds'][0]['state']"/>
                            <t t-esc="br['builds'][0]['job_time']"/> - <t t-esc="br['builds'][0]['job_age']"/>
                        </label>
                    </div>
                    <t t-esc="br['builds'][0]['subject']"/>
                    <div class="col-xs-12 hidden">
                        <div class="btn-group-justified btn-group">
                            <a t-attf-class="btn btn-raised btn-{{klass_p}} {{button_active_klass_p}}"
                                target="_new"
                                t-attf-href="/runbot/#{repo.id}/#{br['branch'].branch_name}"
                                title="Quick Connect last built">
                                <i class="material-icons">open_in_new</i>
                            </a>
                            <a class="btn btn-default"
                                t-attf-href="{{br['branch'].branch_url}}"
                                target="_new"
                                title="Branch where this source code is pulled from">
                                <i class="material-icons">rate_review</i>
                            </a>
                            <a class="btn btn-default" href="javascript:void(0)">
                                <i class="material-icons">view_list</i>
                            </a>
                            <a class="btn btn-default" t-attf-href="/runbot/build/{{br['builds'][0]['id']}}" target="_new">
                                <i class="material-icons">pageview</i>
                            </a>
                            <a class="btn btn-default">
                                <i class="material-icons">share</i>
                            </a>
                            <a  class="btn btn-secondary vauxooci-archive">
                                <i class="material-icons">archive</i>
                            </a>
                            <a class="btn btn-default vauxooci-display" href="javascript:void(0)" t-attf-data-target-id="branch{{br['branch'].id}}">
                                <i class="material-icons">keyboard_arrow_down</i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        <template id="vauxooci.build_row_md" name="Row Header">
            <div class="last-build hidden-xs">
            <div t-attf-class="row {{klass_p}}" style="border-bottom: 1px solid #ccc; padding-bottom: 0px">
                <div class="col-md-4 col-xs-12">
                    <span>
                            <label t-attf-class="label label-{{klass_p}}">
                            <i t-if="not br['branch'].sticky" class="material-icons">call_merge</i>
                            <i t-if="br['branch'].sticky" class="material-icons" style="color: #f0ad4e">star</i>
                            <t t-esc="br['branch'].branch_name"/>
                            <t t-esc="br['builds'][0]['job_time']"/> - <t t-esc="br['builds'][0]['job_age']"/>
                            <t t-esc="br['builds'][0]['state']"/></label> and It was
                            authored by: <a href="#" t-id="br['builds'][0]['author']"><t t-esc="br['builds'][0]['author']"/></a>
                        <t t-if="br['builds'][0]['committer'] and br['builds'][0]['author'] != br['builds'][0]['committer']">
                            and committed by: <a href="#" t-id="bu['committer']"><t t-esc="br['builds'][0]['committer']"/></a>
                            <label class="label label-success">
                                <i class="material-icons">sentiment_very_satisfied</i>
                            </label>
                        </t>
                    </span>
                        <t t-if="br['builds'][0]['committer'] and br['branch'].sticky and br['builds'][0]['author'] == br['builds'][0]['committer']">
                            <span class="label label-warning" title="Not good, author and commiter is the same, this should be reiviewed by somebody else.">
                                <i class="material-icons">sentiment_very_dissatisfied</i>
                            </span>
                        </t><br/>
                    <span>
                        <b>Subject:</b> <t t-esc="br['builds'][0]['subject']"/>
                    </span>
                </div>
                <div class="col-md-8 col-xs-12">
                    <div class="btn-group-justified btn-group">
                        <a t-attf-class="btn btn-default btn-{{klass_p}} {{button_active_klass_p}}"
                            target="_new"
                            t-attf-href="/runbot/#{repo.id}/#{br['branch'].branch_name}"
                            title="Quick Connect last built">
                            <i class="material-icons">open_in_new</i>
                        </a>
                        <a class="btn btn-default"
                            t-attf-href="{{br['branch'].branch_url}}"
                            target="_new"
                            title="Branch where this source code is pulled from">
                            <span>Code Review </span>
                            <i class="material-icons">rate_review</i>
                        </a>
                        <a class="btn btn-default" t-attf-href="/runbot/build/{{br['builds'][0]['id']}}" target="_new">
                            <span>Build </span>
                            <i class="material-icons">pageview</i>
                        </a>
                        <a class="btn btn-default" href="javascript:void(0)">
                            <span>Logs </span>
                            <i class="material-icons">view_list</i>
                        </a>
                        <a class="btn   btn-default">
                            <span>Share </span>
                            <i class="material-icons">share</i>
                        </a>
                        <a  class="btn btn-secondary vauxooci-archive">
                            <span>Archive </span>
                            <i class="material-icons">archive</i>
                        </a>
                        <a class="btn btn-default vauxooci-display" href="javascript:void(0)" t-attf-data-target-id="branch{{br['branch'].id}}">
                            <i class="material-icons">keyboard_arrow_down</i>
                        </a>
                    </div>
                </div>
            </div>
            </div>
        </template>
        <template id="vauxooci.builds_all" name="Row on Buld table">
            <section class="build-row" t-foreach="branches" t-as="br">
                <t t-if="br['builds'] and br['builds'][0]['result'] == 'ko'"><t t-set="klass_p">danger</t></t>
                <t t-if="br['builds'] and br['builds'][0]['result'] == 'warn'"><t t-set="klass_p">warning</t></t>
                <t t-if="br['builds'] and br['builds'][0]['result'] == 'ok'"><t t-set="klass_p">success</t></t>
                <t t-if="br['builds'] and br['builds'][0]['result'] == 'skipped'"><t t-set="klass_p">default</t></t>
                <t t-if="br['builds'] and br['builds'][0]['result'] == 'killed'"><t t-set="klass_p">killed</t></t>
                <t t-if="br['builds'] and br['builds'][0]['state']=='testing'"><t t-set="klass_p">info</t></t>
                <t t-if="br['builds'] and br['builds'][0]['state']=='running'"><t t-set="button_active_klass_p"></t></t>
                <t t-if="br['builds'] and br['builds'][0]['state']!='running'"><t t-set="button_active_klass_p">disabled</t></t>
                <div class="container-fluid">
                    <t t-call="vauxooci.build_row_md"/>
                </div>
                <t t-call="vauxooci.build_row_xs"/>
                <div class="row row-full hidden" t-attf-id="branch{{br['branch'].id}}">
                    <t t-foreach="br['builds']" t-as="bu">
                        <t t-if="bu['state']=='pending'"><t t-set="klass">default</t></t>
                        <t t-if="bu['state']=='testing'"><t t-set="klass">info</t></t>
                        <t t-if="bu['state'] in ['running','done'] and bu['result'] == 'ko'"><t t-set="klass">danger</t></t>
                        <t t-if="bu['state'] in ['running','done'] and bu['result'] == 'warn'"><t t-set="klass">warning</t></t>
                        <t t-if="bu['state'] in ['running','done'] and bu['result'] == 'ok'"><t t-set="klass">success</t></t>
                        <t t-if="bu['state'] in ['running','done'] and bu['result'] == 'skipped'"><t t-set="klass">default</t></t>
                        <t t-if="bu['state'] in ['running','done'] and bu['result'] == 'killed'"><t t-set="klass">killed</t></t>
                        <div t-attf-class="col-md-3 col-lg-3 {{klass}}">
                            <t t-call="vauxooci.build_body"/>
                        </div>
                    </t>
                </div>
            </section>
        </template>
        <template id="vauxooci.expand_all" name="Info">
            <div class="btn-group">
                <a type="button" class="btn btn-fab btn-info" data-toggle="modal" title="Expand all builds." href="#" data-target="#info_modal">
                    <i class="material-icons">expand_more</i>
                </a>
            </div>
            <t t-call="vauxooci.info_modal"/>
        </template>
        <template id="vauxooci.about" name="Info">
            <div class="btn-group">
                <a type="button" class="btn btn-fab btn-info" data-toggle="modal" href="#" data-target="#info_modal">
                    <i class="material-icons">info</i>
                </a>
            </div>
            <t t-call="vauxooci.info_modal"/>
        </template>
        <template inherit_id="runbot.repo" id="vauxooci.repo">
            <!-- just replacing the original repo view calling our layout. -->
            <xpath expr="//t[@t-call='website.layout']" position="replace">
                <t t-call='vauxooci.layout'>
                    <t t-set="head">
                        <t t-if="refresh">
                            <meta http-equiv="refresh" t-att-content="refresh"/>
                        </t>
                    </t>
                    <t t-set="title">
                        Repo:
                        <t t-esc="repo.display_name"/>
                    </t>
                    <t t-if="repo">
                        <div class="jumbotron">
                            <div class="container">
                                <h2 class="text-left">
                                    Nice Alias<br/><small class="hidden-xs"><t t-esc="repo.name"/></small>
                                </h2>
                            </div>
                        </div>
                        <div class="text-center main-group">
                            <t t-call="vauxooci.about"/>
                            <t t-call="vauxooci.login_menu"/>
                            <t t-call="vauxooci.dropdown_repositories"/>
                            <t t-call="vauxooci.expand_all"/>
                        </div>
                        <!-- Class just for styling.
                             -->
                        <div class="row search-box">
                            <t t-call="vauxooci.input_search"/>
                        </div>
                        <t t-call="vauxooci.builds_all"/>
                    </t>
                    <t t-if="not repo">
                       <h1>No Repository yet.</h1>
                    </t>
                </t>
            </xpath>
        </template>
    </data>
</openerp>

